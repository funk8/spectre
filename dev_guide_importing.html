<!-- HTML header for doxygen 1.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=9"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="author" content="SXS Collaboration">
    <meta name="generator" content="Doxygen 1.9.3"/>
  <title>SpECTRE: Importing data</title>
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="./MathJax.js"></script>
  <link href="octicons.css" rel="stylesheet">
  <link href="doxygen.css" rel="stylesheet" type="text/css" />
  <link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="https://unpkg.com/tippy.js@6"></script>
  <script type="text/javascript" src="spectre.js"></script>
  <script type="text/javascript" src="doxygen-navtree-hacks.js"></script>
  </head>
  <body>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
  <div id="titlearea">
    <table cellspacing="0" cellpadding="0">
      <tbody>
        <tr style="height: 56px;">
          <td id="projectalign" style="padding-left: 0.5em;">
            <div id="projectname">
              <a href="index.html">SpECTRE</a>
              &#160;<span id="projectnumber">v2022.01.03</span>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('dev_guide_importing.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Importing data </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_docs_DevGuide_ImportingData"></a> The <code>importers</code> namespace holds functionality for importing data into SpECTRE. We currently support loading volume data files in the same format that is written by the <code>observers</code>.</p>
<h1><a class="anchor" id="autotoc_md80"></a>
Importing volume data</h1>
<p >The <code><a class="el" href="structimporters_1_1ElementDataReader.html" title="A nodegroup parallel component that reads in a volume data file and distributes its data to elements ...">importers::ElementDataReader</a></code> parallel component is responsible for loading volume data and distributing it to elements of one or multiple array parallel components. As a first step, make sure you have added the <code><a class="el" href="structimporters_1_1ElementDataReader.html" title="A nodegroup parallel component that reads in a volume data file and distributes its data to elements ...">importers::ElementDataReader</a></code> to your <code>Metavariables::component_list</code>. Also make sure you have a <code>Metavariables::Phase</code> in which you will perform registration with the importer, and another in which you want to load the data. Here's an example for such <code>Metavariables</code>:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keywordtype">size_t</span> Dim&gt;</div>
<div class="line"><span class="keyword">struct </span>Metavariables {</div>
<div class="line">  <span class="keyword">using</span> component_list =</div>
<div class="line">      tmpl::list&lt;ElementArray&lt;Dim, Grid::Fine, Metavariables&gt;,</div>
<div class="line">                 ElementArray&lt;Dim, Grid::Coarse, Metavariables&gt;,</div>
<div class="line">                 TestDataWriter&lt;Dim, Metavariables&gt;,</div>
<div class="line">                 <a class="code hl_struct" href="structimporters_1_1ElementDataReader.html">importers::ElementDataReader&lt;Metavariables&gt;</a>&gt;;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span> help{<span class="stringliteral">&quot;Test the volume data reader&quot;</span>};</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">constexpr</span> <span class="keywordtype">bool</span> ignore_unrecognized_command_line_options = <span class="keyword">false</span>;</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">enum class</span> Phase { Initialization, Register, ImportData, TestResult, Exit };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span>... Tags&gt;</div>
<div class="line">  <span class="keyword">static</span> Phase determine_next_phase(</div>
<div class="line">      <span class="keyword">const</span> <a class="code hl_class" href="classgsl_1_1not__null.html">gsl::not_null</a>&lt;</div>
<div class="line">          <a class="code hl_class" href="classtuples_1_1TaggedTuple.html">tuples::TaggedTuple&lt;Tags...&gt;</a>*&gt; <span class="comment">/*phase_change_decision_data*/</span>,</div>
<div class="line">      <span class="keyword">const</span> Phase&amp; current_phase,</div>
<div class="line">      <span class="keyword">const</span> Parallel::CProxy_GlobalCache&lt;Metavariables&gt;&amp; <span class="comment">/*cache_proxy*/</span>) {</div>
<div class="line">    <span class="keywordflow">switch</span> (current_phase) {</div>
<div class="line">      <span class="keywordflow">case</span> Phase::Initialization:</div>
<div class="line">        <span class="keywordflow">return</span> Phase::Register;</div>
<div class="line">      <span class="keywordflow">case</span> Phase::Register:</div>
<div class="line">        <span class="keywordflow">return</span> Phase::ImportData;</div>
<div class="line">      <span class="keywordflow">case</span> Phase::ImportData:</div>
<div class="line">        <span class="keywordflow">return</span> Phase::TestResult;</div>
<div class="line">      <span class="keywordflow">default</span>:</div>
<div class="line">        <span class="keywordflow">return</span> Phase::Exit;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// NOLINTNEXTLINE(google-runtime-references)</span></div>
<div class="line">  <span class="keywordtype">void</span> pup(PUP::er&amp; <span class="comment">/*p*/</span>) {}</div>
<div class="line">};</div>
<div class="ttc" id="aclassgsl_1_1not__null_html"><div class="ttname"><a href="classgsl_1_1not__null.html">gsl::not_null</a></div><div class="ttdoc">Require a pointer to not be a nullptr</div><div class="ttdef"><b>Definition:</b> Gsl.hpp:183</div></div>
<div class="ttc" id="aclasstuples_1_1TaggedTuple_html"><div class="ttname"><a href="classtuples_1_1TaggedTuple.html">tuples::TaggedTuple&lt; Tags... &gt;</a></div></div>
<div class="ttc" id="astructimporters_1_1ElementDataReader_html"><div class="ttname"><a href="structimporters_1_1ElementDataReader.html">importers::ElementDataReader</a></div><div class="ttdoc">A nodegroup parallel component that reads in a volume data file and distributes its data to elements ...</div><div class="ttdef"><b>Definition:</b> ElementDataReader.hpp:38</div></div>
</div><!-- fragment --><p >To load volume data from a file, invoke the <code><a class="el" href="structimporters_1_1Actions_1_1ReadVolumeData.html" title="Read a volume data file and distribute the data to all registered elements.">importers::Actions::ReadVolumeData</a></code> iterable action in the <code>phase_dependent_action_list</code> of your array parallel component. Here's an example that will be explained in more detail below:</p>
<div class="fragment"><div class="line">      <a class="code hl_struct" href="structParallel_1_1PhaseActions.html">Parallel::PhaseActions</a>&lt;</div>
<div class="line">          <span class="keyword">typename</span> Metavariables::Phase, Metavariables::Phase::Register,</div>
<div class="line">          tmpl::list&lt;<a class="code hl_struct" href="structimporters_1_1Actions_1_1RegisterWithElementDataReader.html">importers::Actions::RegisterWithElementDataReader</a>,</div>
<div class="line">                     <a class="code hl_struct" href="structParallel_1_1Actions_1_1TerminatePhase.html">Parallel::Actions::TerminatePhase</a>&gt;&gt;,</div>
<div class="line">      <a class="code hl_struct" href="structParallel_1_1PhaseActions.html">Parallel::PhaseActions</a>&lt;</div>
<div class="line">          <span class="keyword">typename</span> Metavariables::Phase, Metavariables::Phase::ImportData,</div>
<div class="line">          tmpl::list&lt;<a class="code hl_struct" href="structimporters_1_1Actions_1_1ReadVolumeData.html">importers::Actions::ReadVolumeData</a>&lt;</div>
<div class="line">                         VolumeDataOptions&lt;TheGrid&gt;, import_fields&gt;,</div>
<div class="line">                     <a class="code hl_struct" href="structimporters_1_1Actions_1_1ReceiveVolumeData.html">importers::Actions::ReceiveVolumeData</a>&lt;</div>
<div class="line">                         VolumeDataOptions&lt;TheGrid&gt;, import_fields&gt;,</div>
<div class="line">                     <a class="code hl_struct" href="structParallel_1_1Actions_1_1TerminatePhase.html">Parallel::Actions::TerminatePhase</a>&gt;&gt;,</div>
<div class="ttc" id="astructParallel_1_1Actions_1_1TerminatePhase_html"><div class="ttname"><a href="structParallel_1_1Actions_1_1TerminatePhase.html">Parallel::Actions::TerminatePhase</a></div><div class="ttdoc">Terminate the algorithm to proceed to the next phase.</div><div class="ttdef"><b>Definition:</b> TerminatePhase.hpp:26</div></div>
<div class="ttc" id="astructParallel_1_1PhaseActions_html"><div class="ttname"><a href="structParallel_1_1PhaseActions.html">Parallel::PhaseActions</a></div><div class="ttdoc">List of all the actions to be executed in the specified phase.</div><div class="ttdef"><b>Definition:</b> PhaseDependentActionList.hpp:16</div></div>
<div class="ttc" id="astructimporters_1_1Actions_1_1ReadVolumeData_html"><div class="ttname"><a href="structimporters_1_1Actions_1_1ReadVolumeData.html">importers::Actions::ReadVolumeData</a></div><div class="ttdoc">Read a volume data file and distribute the data to all registered elements.</div><div class="ttdef"><b>Definition:</b> ReadVolumeData.hpp:67</div></div>
<div class="ttc" id="astructimporters_1_1Actions_1_1ReceiveVolumeData_html"><div class="ttname"><a href="structimporters_1_1Actions_1_1ReceiveVolumeData.html">importers::Actions::ReceiveVolumeData</a></div><div class="ttdoc">Wait for data from a volume data file to arrive and directly move it into the DataBox.</div><div class="ttdef"><b>Definition:</b> ReceiveVolumeData.hpp:30</div></div>
<div class="ttc" id="astructimporters_1_1Actions_1_1RegisterWithElementDataReader_html"><div class="ttname"><a href="structimporters_1_1Actions_1_1RegisterWithElementDataReader.html">importers::Actions::RegisterWithElementDataReader</a></div><div class="ttdoc">Register an element with the volume data reader component.</div><div class="ttdef"><b>Definition:</b> RegisterWithElementDataReader.hpp:42</div></div>
</div><!-- fragment --><ul>
<li>The <code><a class="el" href="structimporters_1_1Actions_1_1ReadVolumeData.html" title="Read a volume data file and distribute the data to all registered elements.">importers::Actions::ReadVolumeData</a></code> action will load the volume data file once per node on its first invocation by dispatching to <code><a class="el" href="structimporters_1_1Actions_1_1ReadAllVolumeDataAndDistribute.html" title="Read a volume data file and distribute the data to all registered elements.">importers::Actions::ReadAllVolumeDataAndDistribute</a></code> on the <code><a class="el" href="structimporters_1_1ElementDataReader.html" title="A nodegroup parallel component that reads in a volume data file and distributes its data to elements ...">importers::ElementDataReader</a></code> nodegroup component. Subsequent invocations of these actions, e.g. from all other elements on the node, will do nothing. The data is distributed into the inboxes of all elements on the node under the <code><a class="el" href="structimporters_1_1Tags_1_1VolumeData.html" title="Inbox tag that carries the data read from a volume data file.">importers::Tags::VolumeData</a></code> tag using <code><a class="el" href="group__ParallelGroup.html#gad1078fa99233851c6475fbfa99a2f51d" title="Send the data args... to the algorithm running on proxy, and tag the message with the identifier temp...">Parallel::receive_data</a></code>.</li>
<li>The <code><a class="el" href="structimporters_1_1Actions_1_1ReceiveVolumeData.html" title="Wait for data from a volume data file to arrive and directly move it into the DataBox.">importers::Actions::ReceiveVolumeData</a></code> action waits for the volume data to be available and directly moves it into the DataBox. If you wish to verify or post-process the data before populating the DataBox, use your own specialized action in place of <code><a class="el" href="structimporters_1_1Actions_1_1ReceiveVolumeData.html" title="Wait for data from a volume data file to arrive and directly move it into the DataBox.">importers::Actions::ReceiveVolumeData</a></code>.</li>
<li>You need to register the elements of your array parallel component for receiving volume data. To do so, invoke the <code><a class="el" href="structimporters_1_1Actions_1_1RegisterWithElementDataReader.html" title="Register an element with the volume data reader component.">importers::Actions::RegisterWithElementDataReader</a></code> action in an earlier phase, as shown in the example above.</li>
</ul>
<p >The template parameters to the actions in the example above specify the volume data to load. The first template parameter is an option group that determines the file to read and the second parameter is a typelist of the tags to import and fill with the volume data. See the documentation of the <code><a class="el" href="structimporters_1_1Actions_1_1ReadAllVolumeDataAndDistribute.html" title="Read a volume data file and distribute the data to all registered elements.">importers::Actions::ReadAllVolumeDataAndDistribute</a></code> action for details on these parameters. In the example above, the <code>VolumeDataOptions</code> is an option group that supplies information such as the file name. You provide an option group that represents the data you want to import. For example, we have the <code><a class="el" href="structevolution_1_1OptionTags_1_1NumericInitialData.html" title="Holds option tags for importing numeric initial data for an evolution.">evolution::OptionTags::NumericInitialData</a></code> that represents numeric initial data for an evolution. In our example, we created a new class like this:</p>
<div class="fragment"><div class="line"><span class="keyword">template</span> &lt;Gr<span class="keywordtype">id</span> TheGr<span class="keywordtype">id</span>&gt;</div>
<div class="line"><span class="keyword">struct </span>VolumeDataOptions {</div>
<div class="line">  <span class="keyword">using</span> group = <a class="code hl_struct" href="structimporters_1_1OptionTags_1_1Group.html">importers::OptionTags::Group</a>;</div>
<div class="line">  <span class="keyword">static</span> <a class="code hl_classRef" href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a> name() { <span class="keywordflow">return</span> <a class="code hl_class" href="classMakeString.html">MakeString</a>{} &lt;&lt; TheGrid &lt;&lt; <span class="stringliteral">&quot;VolumeData&quot;</span>; }</div>
<div class="line">  <span class="keyword">static</span> <span class="keyword">constexpr</span> <a class="code hl_typedef" href="namespaceOptions.html#aa61c7f41f21afa7646811456f673be89">Options::String</a> help = <span class="stringliteral">&quot;Numeric volume data&quot;</span>;</div>
<div class="line">};</div>
<div class="ttc" id="abasic_string_html"><div class="ttname"><a href="http://en.cppreference.com/w/cpp/string/basic_string.html">std::string</a></div></div>
<div class="ttc" id="aclassMakeString_html"><div class="ttname"><a href="classMakeString.html">MakeString</a></div><div class="ttdoc">Make a string by streaming into object.</div><div class="ttdef"><b>Definition:</b> MakeString.hpp:18</div></div>
<div class="ttc" id="anamespaceOptions_html_aa61c7f41f21afa7646811456f673be89"><div class="ttname"><a href="namespaceOptions.html#aa61c7f41f21afa7646811456f673be89">Options::String</a></div><div class="ttdeci">const char *const String</div><div class="ttdoc">The string used in option structs.</div><div class="ttdef"><b>Definition:</b> Options.hpp:32</div></div>
<div class="ttc" id="astructimporters_1_1OptionTags_1_1Group_html"><div class="ttname"><a href="structimporters_1_1OptionTags_1_1Group.html">importers::OptionTags::Group</a></div><div class="ttdoc">Groups the data importer configurations in the input file.</div><div class="ttdef"><b>Definition:</b> Tags.hpp:27</div></div>
</div><!-- fragment --><p >This results in a section in the input file that may look like this:</p>
<div class="fragment"><div class="line">Importers:</div>
<div class="line">  FineVolumeData:</div>
<div class="line">    FileName: &quot;Test_DataImporterAlgorithm2D_shared.h5&quot;</div>
<div class="line">    Subgroup: &quot;fine_data&quot;</div>
<div class="line">    ObservationValue: 3.</div>
<div class="line">  CoarseVolumeData:</div>
<div class="line">    FileName: &quot;Test_DataImporterAlgorithm2D_shared.h5&quot;</div>
<div class="line">    Subgroup: &quot;coarse_data&quot;</div>
<div class="line">    ObservationValue: 2.</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.1-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dev_guide.html">Developer Guides</a></li>
    <li class="footer">
    &copy; Copyright 2017 - 2022
    <a href="https://black-holes.org">SXS Collaboration</a>,
    <a href="LICENSE.txt" target="_blank">
    <span class="hidden-xs">Distributed under the</span>
    MIT License</a>
  </ul>
</div>
</body>
</html>
